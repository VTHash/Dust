<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DustClaim – Linea</title>

  <style>
    :root{
      --bg0:#05080d;
      --text:#e6edf3;
      --muted:rgba(230,237,243,.72);
      --blue:#38bdf8;
      --green:#22c55e;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:system-ui,Arial;
      background:var(--bg0);
      color:var(--text);
    }

    .wrap{
      max-width:860px;
      margin:auto;
      padding:20px;
    }

    .card{
      background:rgba(10,14,30,.6);
      border-radius:24px;
      padding:20px;
      border:2px solid rgba(99,102,241,.6);
      box-shadow:0 0 30px rgba(99,102,241,.5);
    }

    .title{
      font-size:22px;
      font-weight:900;
      margin-bottom:4px;
    }

    .muted{font-size:13px;color:var(--muted)}

    .note{
      margin-top:12px;
      font-size:13px;
    }

    .row{
      display:flex;
      justify-content:space-between;
      margin-top:10px;
      padding:12px;
      background:rgba(18,22,46,.6);
      border-radius:14px;
    }

    .btn{
      width:100%;
      margin-top:10px;
      padding:14px;
      border-radius:14px;
      border:none;
      font-weight:900;
      cursor:pointer;
    }

    .btn-secondary{
      background:rgba(18,22,46,.8);
      color:var(--text);
      border:1px solid rgba(99,102,241,.5);
    }

    .btn-primary{
      background:linear-gradient(135deg,#7c3aed,#38bdf8);
      color:#061020;
    }

    .pill{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(99,102,241,.5);
    }

    .ok,.err{
      margin-top:12px;
      padding:12px;
      border-radius:12px;
      white-space:pre-wrap;
    }

    .ok{border:1px solid #38bdf8}
    .err{border:1px solid #ff6b6b;color:#ffbdbd}
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="title">Claim your daily DUST</div>
    <div class="muted">Linea · 5 DUST / 24h · 6 months</div>

    <div class="note">
      Requires at least <b>0.001 ETH</b> in wallet.
    </div>

    <button id="mmBtn" class="btn btn-secondary">Connect MetaMask</button>
    <button id="wcBtn" class="btn btn-secondary">Connect Wallet (WalletConnect)</button>

    <div class="row"><span>Wallet</span><span id="wallet">—</span></div>
    <div class="row"><span>Network</span><span id="network">—</span></div>
    <div class="row"><span>Can claim</span><span id="canClaim" class="pill">—</span></div>
    <div class="row"><span>Next claim</span><span id="nextClaim">—</span></div>

    <button id="claimBtn" class="btn btn-primary" disabled>Claim 5 DUST</button>

    <div id="ok" class="ok" style="display:none"></div>
    <div id="err" class="err" style="display:none"></div>
  </div>
</div>

<!-- Ethers -->
<script src="https://cdn.jsdelivr.net/npm/ethers@6.15.0/dist/ethers.umd.min.js"></script>

<!-- WalletConnect v2 -->
<script type="module">
  import EthereumProvider from "https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.17.5/dist/index.es.js";

  const LINEA_ID = 59144;
  const LINEA_HEX = "0xE708";
  const CONTRACT = "0xF312Ec9f8087C87fbF3439B0369eA233a1EE4A7D";

  const PROJECT_ID = "REPLACE_WITH_REOWN_PROJECT_ID";

  const ABI = [
    "function claimDaily()",
    "function canClaim(address) view returns (bool,string)",
    "function nextClaimTime(address) view returns (uint256)"
  ];

  let provider, signer, contract, wcProvider;

  const $ = id => document.getElementById(id);
  const show = (el,msg)=>{el.style.display="block";el.textContent=msg};
  const hide = el=>el.style.display="none";

  async function switchLinea(p){
    const id = await p.request({method:"eth_chainId"});
    if(parseInt(id,16)===LINEA_ID) return;
    await p.request({method:"wallet_switchEthereumChain",params:[{chainId:LINEA_HEX}]});
  }

  async function refresh(addr){
    const [ok,reason] = await contract.canClaim(addr);
    const next = await contract.nextClaimTime(addr);
    $("canClaim").textContent = ok ? "YES" : "NO";
    $("nextClaim").textContent = ok ? "Now" : new Date(Number(next)*1000).toLocaleString();
    $("claimBtn").disabled = !ok;
  }

  async function connectMM(){
    if(!window.ethereum){alert("Install MetaMask");return}
    const accounts = await window.ethereum.request({method:"eth_requestAccounts"});
    await switchLinea(window.ethereum);
    provider = new ethers.BrowserProvider(window.ethereum);
    signer = await provider.getSigner();
    contract = new ethers.Contract(CONTRACT,ABI,signer);
    $("wallet").textContent = accounts[0].slice(0,6)+"…";
    $("network").textContent = "Linea";
    await refresh(accounts[0]);
  }

  async function connectWC(){
    wcProvider = await EthereumProvider.init({
      projectId: PROJECT_ID,
      chains: [LINEA_ID],
      showQrModal: true,
      metadata:{
        name:"DustClaim",
        url:"https://dustclaim.eth.limo",
        icons:[]
      }
    });

    await wcProvider.connect();
    await switchLinea(wcProvider);

    provider = new ethers.BrowserProvider(wcProvider);
    signer = await provider.getSigner();
    const addr = await signer.getAddress();
    contract = new ethers.Contract(CONTRACT,ABI,signer);

    $("wallet").textContent = addr.slice(0,6)+"…";
    $("network").textContent = "Linea";
    await refresh(addr);
  }

  async function claim(){
    try{
      const tx = await contract.claimDaily();
      show($("ok"),"Transaction sent\n"+tx.hash);
      await tx.wait();
      show($("ok"),"Claim successful");
    }catch(e){
      show($("err"),e.message);
    }
  }

  $("mmBtn").onclick = connectMM;
  $("wcBtn").onclick = connectWC;
  $("claimBtn").onclick = claim;
</script>
</body>
</html>